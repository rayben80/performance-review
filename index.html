<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í´ë¼ìš°ë“œì‚¬ì—…ë³¸ë¶€ ì—…ë¬´í‰ê°€ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            background-color: #3b82f6;
            color: white;
            border-bottom-color: transparent;
        }
        .drag-handle {
            cursor: grab;
        }
        .drag-handle:active {
            cursor: grabbing;
        }
        .dragging {
            opacity: 0.5;
        }
        .evaluation-item {
            transition: all 0.2s ease;
        }
        .evaluation-item:hover {
            background-color: #f8fafc;
        }
        
        /* Loading animation */
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Smooth transitions */
        .transition-all {
            transition: all 0.3s ease;
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <i class="fas fa-chart-line text-blue-600 text-2xl"></i>
                        <h1 class="text-2xl font-bold text-gray-900">í´ë¼ìš°ë“œì‚¬ì—…ë³¸ë¶€ ì—…ë¬´í‰ê°€ ì‹œìŠ¤í…œ</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- User Role Selector -->
                        <div class="text-sm text-gray-600">
                            <select id="userRoleSelect" onchange="switchUserRole()" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="admin">ğŸ‘¨â€ğŸ’¼ ê´€ë¦¬ì (Admin)</option>
                                <option value="employee">ğŸ‘¤ íŒ€ì› (Employee)</option>
                            </select>
                        </div>
                        <div class="text-sm text-gray-600">
                            <span id="currentUser">ê´€ë¦¬ì</span>
                        </div>
                        <button onclick="showUserMenu()" class="text-gray-500 hover:text-gray-700 relative">
                            <i class="fas fa-user-circle text-xl"></i>
                        </button>
                        <!-- User Menu Dropdown -->
                        <div id="userMenu" class="hidden absolute right-0 top-full mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-50">
                            <div class="py-1">
                                <a href="#" onclick="showUserProfile()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-user mr-2"></i>í”„ë¡œí•„
                                </a>
                                <a href="#" onclick="showUserSettings()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-cog mr-2"></i>ì„¤ì •
                                </a>
                                <div class="border-t border-gray-100"></div>
                                <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
                                    <i class="fas fa-sign-out-alt mr-2"></i>ë¡œê·¸ì•„ì›ƒ
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex space-x-0">
                    <button onclick="showTab('overview')" class="tab-button px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 border-b-2 border-transparent transition-colors">
                        <i class="fas fa-tachometer-alt mr-2"></i>ê°œìš”
                    </button>
                    <button onclick="showTab('settings')" class="tab-button px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 border-b-2 border-transparent transition-colors">
                        <i class="fas fa-cog mr-2"></i>ì„¤ì •
                    </button>
                    <button onclick="showTab('evaluation')" class="tab-button px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 border-b-2 border-transparent transition-colors" id="evaluationTab">
                        <i class="fas fa-clipboard-check mr-2"></i>í‰ê°€ ê´€ë¦¬
                    </button>
                    <button onclick="showTab('self-evaluation')" class="tab-button px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 border-b-2 border-transparent transition-colors" id="selfEvaluationTab" style="display: none;">
                        <i class="fas fa-user-check mr-2"></i>ìê¸°í‰ê°€
                    </button>
                    <button onclick="showTab('reports')" class="tab-button px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 border-b-2 border-transparent transition-colors">
                        <i class="fas fa-chart-bar mr-2"></i>ë³´ê³ ì„œ
                    </button>
                    <button onclick="showTab('analysis')" class="tab-button px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 border-b-2 border-transparent transition-colors">
                        <i class="fas fa-analytics mr-2"></i>ë¶„ì„
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-8">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Statistics Cards -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-2 bg-blue-100 rounded-md">
                                <i class="fas fa-users text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">ì´ íŒ€ì› ìˆ˜</p>
                                <p class="text-2xl font-semibold text-gray-900" id="totalMembers">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-2 bg-green-100 rounded-md">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">ì™„ë£Œëœ í‰ê°€</p>
                                <p class="text-2xl font-semibold text-gray-900" id="completedEvaluations">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-2 bg-yellow-100 rounded-md">
                                <i class="fas fa-clock text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">ëŒ€ê¸°ì¤‘ì¸ í‰ê°€</p>
                                <p class="text-2xl font-semibold text-gray-900" id="pendingEvaluations">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">ìµœê·¼ í™œë™</h3>
                    </div>
                    <div class="p-6">
                        <div id="recentActivities" class="space-y-4">
                            <div class="flex items-center space-x-3 text-gray-600">
                                <i class="fas fa-info-circle text-blue-500"></i>
                                <span>ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì„¤ì • íƒ­ì—ì„œ í‰ê°€ í•­ëª©ì„ êµ¬ì„±í•´ì£¼ì„¸ìš”.</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                        <h3 class="text-lg font-medium text-gray-900">í‰ê°€ ì„¤ì •</h3>
                        <div class="flex space-x-2">
                            <button onclick="addEvaluationItem()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                <i class="fas fa-plus mr-2"></i>í•­ëª© ì¶”ê°€
                            </button>
                            <button onclick="resetEvaluationItems()" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors">
                                <i class="fas fa-trash mr-2"></i>ì´ˆê¸°í™”
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <!-- Team Selection -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">íŒ€ ì„ íƒ</label>
                            <select id="teamSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="handleTeamChange()">
                                <option value="">íŒ€ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="development">ê°œë°œíŒ€</option>
                                <option value="design">ë””ìì¸íŒ€</option>
                                <option value="planning">ê¸°íšíŒ€</option>
                                <option value="infrastructure">ì¸í”„ë¼íŒ€</option>
                            </select>
                        </div>

                        <!-- Evaluation Items -->
                        <div class="mb-6">
                            <h4 class="text-md font-medium text-gray-900 mb-4">í‰ê°€ í•­ëª©</h4>
                            <div id="evaluationItems" class="space-y-3">
                                <!-- í‰ê°€ í•­ëª©ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </div>
                        </div>

                        <!-- Save Button -->
                        <div class="flex justify-end">
                            <button onclick="saveSettings()" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                                <i class="fas fa-save mr-2"></i>ì„¤ì • ì €ì¥
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Evaluation Tab -->
            <div id="evaluation" class="tab-content">
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">ì„±ê³¼ í‰ê°€</h3>
                    </div>
                    <div class="p-6">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">í‰ê°€ ëŒ€ìƒì</label>
                            <select id="evaluationTarget" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">í‰ê°€ ëŒ€ìƒìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        
                        <div id="evaluationForm" class="space-y-6">
                            <!-- í‰ê°€ í¼ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>
                        
                        <div class="mt-8 flex justify-end">
                            <button onclick="submitEvaluation()" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                <i class="fas fa-check mr-2"></i>í‰ê°€ ì œì¶œ
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">íŒ€ë³„ í‰ê·  ì ìˆ˜</h3>
                        </div>
                        <div class="p-6">
                            <canvas id="teamScoreChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">í‰ê°€ ì§„í–‰ í˜„í™©</h3>
                        </div>
                        <div class="p-6">
                            <canvas id="progressChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">ìƒì„¸ ë³´ê³ ì„œ</h3>
                    </div>
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì´ë¦„</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">íŒ€</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì´ì </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë“±ê¸‰</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">í‰ê°€ì¼</th>
                                    </tr>
                                </thead>
                                <tbody id="reportTable" class="bg-white divide-y divide-gray-200">
                                    <!-- ë³´ê³ ì„œ ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Tab -->
            <div id="analysis" class="tab-content">
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">ì„±ê³¼ ë¶„ì„</h3>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-md font-medium text-gray-900 mb-4">í•­ëª©ë³„ í‰ê·  ì ìˆ˜</h4>
                                <canvas id="itemAnalysisChart" width="400" height="300"></canvas>
                            </div>
                            <div>
                                <h4 class="text-md font-medium text-gray-900 mb-4">ì ìˆ˜ ë¶„í¬</h4>
                                <canvas id="distributionChart" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Self Evaluation Tab -->
            <div id="self-evaluation" class="tab-content">
                <!-- Welcome Section -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 mb-6 border border-blue-200">
                    <div class="flex items-center space-x-4">
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-user-check text-blue-600 text-2xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-semibold text-blue-900">ìê¸°í‰ê°€</h2>
                            <p class="text-blue-700 mt-1">ë³¸ì¸ì˜ ì„±ê³¼ë¥¼ ìŠ¤ìŠ¤ë¡œ í‰ê°€í•´ë³´ì„¸ìš”. ì†”ì§í•˜ê³  ê°ê´€ì ì¸ í‰ê°€ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>

                <!-- Current Evaluation Status -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-2 bg-green-100 rounded-md">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">ì™„ë£Œëœ í‰ê°€</p>
                                <p class="text-2xl font-semibold text-gray-900" id="selfCompletedCount">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-2 bg-yellow-100 rounded-md">
                                <i class="fas fa-clock text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">ëŒ€ê¸°ì¤‘ì¸ í‰ê°€</p>
                                <p class="text-2xl font-semibold text-gray-900" id="selfPendingCount">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-2 bg-blue-100 rounded-md">
                                <i class="fas fa-percentage text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">í‰ê°€ ì§„í–‰ë¥ </p>
                                <p class="text-2xl font-semibold text-gray-900" id="selfProgressPercent">0%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Evaluation Period Selection -->
                <div class="bg-white rounded-lg shadow mb-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">í‰ê°€ ê¸°ê°„ ì„ íƒ</h3>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">í‰ê°€ ìœ í˜•</label>
                                <select id="evaluationPeriod" onchange="loadSelfEvaluationPeriod()" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">í‰ê°€ ê¸°ê°„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="2025-q1">2025ë…„ 1ë¶„ê¸° í‰ê°€</option>
                                    <option value="2025-q2">2025ë…„ 2ë¶„ê¸° í‰ê°€</option>
                                    <option value="2025-annual">2025ë…„ ì—°ê°„ í‰ê°€</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ë§ˆê°ì¼</label>
                                <input type="date" id="evaluationDeadline" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" readonly>
                            </div>
                        </div>
                        
                        <!-- Deadline Alert -->
                        <div id="deadlineAlert" class="mt-4 hidden">
                            <div class="bg-red-50 border border-red-200 rounded-md p-4">
                                <div class="flex">
                                    <i class="fas fa-exclamation-triangle text-red-500 mt-0.5 mr-2"></i>
                                    <div class="text-red-700">
                                        <strong>ë§ˆê° ì„ë°•!</strong>
                                        <span id="deadlineText">í‰ê°€ ë§ˆê°ê¹Œì§€ ì–¼ë§ˆ ë‚¨ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Self Evaluation Form -->
                <div id="selfEvaluationForm" class="bg-white rounded-lg shadow" style="display: none;">
                    <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                        <h3 class="text-lg font-medium text-gray-900">ìê¸°í‰ê°€ ì–‘ì‹</h3>
                        <div class="flex space-x-2">
                            <button onclick="saveSelfEvaluationDraft()" class="px-4 py-2 text-blue-600 border border-blue-600 rounded-md hover:bg-blue-50 transition-colors">
                                <i class="fas fa-save mr-2"></i>ì„ì‹œì €ì¥
                            </button>
                            <button onclick="previewSelfEvaluation()" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors">
                                <i class="fas fa-eye mr-2"></i>ë¯¸ë¦¬ë³´ê¸°
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <!-- Instructions -->
                        <div class="bg-blue-50 border border-blue-200 rounded-md p-4 mb-6">
                            <h4 class="font-medium text-blue-900 mb-2">
                                <i class="fas fa-info-circle mr-2"></i>í‰ê°€ ì•ˆë‚´
                            </h4>
                            <ul class="text-sm text-blue-800 space-y-1">
                                <li>â€¢ ê° í•­ëª©ë³„ë¡œ 1-100ì  ë²”ìœ„ì—ì„œ ì ìˆ˜ë¥¼ ë§¤ê²¨ì£¼ì„¸ìš”</li>
                                <li>â€¢ ì ìˆ˜ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ê·¼ê±°ì™€ ì‚¬ë¡€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”</li>
                                <li>â€¢ ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ê³¼ í–¥í›„ ê³„íšì„ í¬í•¨í•´ì£¼ì„¸ìš”</li>
                                <li>â€¢ ì„ì‹œì €ì¥ ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ ì—¬ëŸ¬ ë²ˆì— ê±¸ì³ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                            </ul>
                        </div>

                        <!-- Evaluation Items -->
                        <div id="selfEvaluationItems" class="space-y-6">
                            <!-- ë™ì ìœ¼ë¡œ í‰ê°€ í•­ëª©ë“¤ì´ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>

                        <!-- Overall Self Assessment -->
                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <h4 class="text-md font-medium text-gray-900 mb-4">ì¢…í•© ìê¸°í‰ê°€</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ì£¼ìš” ì„±ê³¼ ë° ê¸°ì—¬ì‚¬í•­</label>
                                    <textarea id="selfMajorAchievements" 
                                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                              rows="4" 
                                              placeholder="ì´ë²ˆ í‰ê°€ ê¸°ê°„ ì¤‘ ë‹¬ì„±í•œ ì£¼ìš” ì„±ê³¼ì™€ íŒ€/íšŒì‚¬ì— ê¸°ì—¬í•œ ë¶€ë¶„ì„ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ê°œì„ ì´ í•„ìš”í•œ ì˜ì—­</label>
                                    <textarea id="selfImprovementAreas" 
                                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                              rows="4" 
                                              placeholder="ê°œì„ ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ì˜ì—­ê³¼ ê·¸ ì´ìœ ë¥¼ ì†”ì§í•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">í–¥í›„ ëª©í‘œ ë° ê³„íš</label>
                                    <textarea id="selfFutureGoals" 
                                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                              rows="4" 
                                              placeholder="ë‹¤ìŒ í‰ê°€ ê¸°ê°„ê¹Œì§€ì˜ ëª©í‘œì™€ êµ¬ì²´ì ì¸ ì‹¤í–‰ ê³„íšì„ ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="mt-8 pt-6 border-t border-gray-200 flex justify-between">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-save mr-1"></i>
                                <span id="lastSavedTime">ì•„ì§ ì €ì¥ë˜ì§€ ì•ŠìŒ</span>
                            </div>
                            <div class="space-x-3">
                                <button onclick="resetSelfEvaluation()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                                    <i class="fas fa-undo mr-2"></i>ì´ˆê¸°í™”
                                </button>
                                <button onclick="saveSelfEvaluationDraft()" class="px-4 py-2 text-blue-600 border border-blue-600 rounded-md hover:bg-blue-50 transition-colors">
                                    <i class="fas fa-save mr-2"></i>ì„ì‹œì €ì¥
                                </button>
                                <button onclick="submitSelfEvaluation()" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-paper-plane mr-2"></i>í‰ê°€ ì œì¶œ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Previous Evaluations -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">ì´ì „ ìê¸°í‰ê°€ ê¸°ë¡</h3>
                    </div>
                    <div class="p-6">
                        <div id="previousSelfEvaluations" class="space-y-4">
                            <!-- ì´ì „ í‰ê°€ ê¸°ë¡ë“¤ì´ ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
                            <div class="text-center text-gray-500 py-8">
                                <i class="fas fa-history text-4xl mb-4 opacity-50"></i>
                                <p>ì•„ì§ ì™„ë£Œëœ ìê¸°í‰ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                                <p class="text-sm">ì²« ë²ˆì§¸ ìê¸°í‰ê°€ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="enhanced-settings-ui.js"></script>
    <script>
        // Global variables
        let currentTab = 'overview';
        let evaluationItems = [];
        let teamData = {};
        let evaluationData = [];
        let currentUserRole = 'admin';
        let currentEmployee = null;
        let selfEvaluationData = {};
        let selfEvaluationDrafts = {};

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadData();
            
            // Initialize user role
            switchUserRole();
            
            updateOverviewStats();
            renderSettings();
        }

        // Tab Management
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Add active class to selected button
            const selectedButton = document.querySelector(`[onclick="showTab('${tabName}')"]`);
            if (selectedButton) {
                selectedButton.classList.add('active');
            }
            
            currentTab = tabName;
            
            // Load tab-specific content
            if (tabName === 'reports') {
                generateReports();
            } else if (tabName === 'analysis') {
                generateAnalysis();
            } else if (tabName === 'evaluation') {
                loadEvaluationForm();
            } else if (tabName === 'self-evaluation') {
                loadSelfEvaluationTab();
            }
        }

        // Settings Management
        function renderSettings() {
            const container = document.getElementById('evaluationItems');
            container.innerHTML = '';

            evaluationItems.forEach((item, index) => {
                const itemElement = createEvaluationItemElement(item, index);
                container.appendChild(itemElement);
            });

            // Enhanced UI integration will be added here
            if (typeof enhanceSettingsUI === 'function') {
                enhanceSettingsUI();
            }
        }

        function createEvaluationItemElement(item, index) {
            const div = document.createElement('div');
            div.className = 'evaluation-item bg-gray-50 p-4 rounded-lg border border-gray-200';
            div.draggable = true;
            div.dataset.index = index;

            div.innerHTML = `
                <div class="flex items-center space-x-4">
                    <div class="drag-handle text-gray-400 hover:text-gray-600">
                        <i class="fas fa-grip-vertical"></i>
                    </div>
                    <div class="flex-1">
                        <input type="text" 
                               value="${item.name}" 
                               onchange="updateItemName(${index}, this.value)"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="í‰ê°€ í•­ëª©ëª…">
                    </div>
                    <div class="w-24">
                        <input type="number" 
                               value="${item.weight}" 
                               onchange="updateItemWeight(${index}, this.value)"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="ê°€ì¤‘ì¹˜" 
                               min="0" 
                               max="100">
                    </div>
                    <button onclick="removeEvaluationItem(${index})" 
                            class="text-red-600 hover:text-red-800 transition-colors">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;

            // Add drag and drop event listeners
            div.addEventListener('dragstart', handleDragStart);
            div.addEventListener('dragover', handleDragOver);
            div.addEventListener('drop', handleDrop);
            div.addEventListener('dragend', handleDragEnd);

            return div;
        }

        function addEvaluationItem() {
            const newItem = {
                id: Date.now(),
                name: `í‰ê°€ í•­ëª© ${evaluationItems.length + 1}`,
                weight: 10,
                description: ''
            };
            evaluationItems.push(newItem);
            renderSettings();
        }

        function removeEvaluationItem(index) {
            if (confirm('ì´ í‰ê°€ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                evaluationItems.splice(index, 1);
                renderSettings();
            }
        }

        function updateItemName(index, name) {
            if (evaluationItems[index]) {
                evaluationItems[index].name = name;
            }
        }

        function updateItemWeight(index, weight) {
            if (evaluationItems[index]) {
                evaluationItems[index].weight = parseInt(weight) || 0;
            }
        }

        function resetEvaluationItems() {
            if (confirm('ëª¨ë“  í‰ê°€ í•­ëª©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                evaluationItems = [];
                renderSettings();
            }
        }

        function saveSettings() {
            // Validate items
            const invalidItems = evaluationItems.filter(item => !item.name.trim());
            if (invalidItems.length > 0) {
                alert('ëª¨ë“  í‰ê°€ í•­ëª©ì— ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // Save to localStorage
            localStorage.setItem('evaluationItems', JSON.stringify(evaluationItems));
            localStorage.setItem('teamData', JSON.stringify(teamData));
            
            alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            updateOverviewStats();
        }

        // Drag and Drop functionality
        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            if (draggedElement !== this) {
                const draggedIndex = parseInt(draggedElement.dataset.index);
                const targetIndex = parseInt(this.dataset.index);
                
                // Reorder array
                const draggedItem = evaluationItems[draggedIndex];
                evaluationItems.splice(draggedIndex, 1);
                evaluationItems.splice(targetIndex, 0, draggedItem);
                
                // Re-render
                renderSettings();
            }

            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            draggedElement = null;
        }

        // Team Management
        function handleTeamChange() {
            const teamSelect = document.getElementById('teamSelect');
            const selectedTeam = teamSelect.value;
            
            if (selectedTeam && !teamData[selectedTeam]) {
                teamData[selectedTeam] = {
                    name: teamSelect.options[teamSelect.selectedIndex].text,
                    members: []
                };
            }
            
            updateTeamMembers(selectedTeam);
        }

        function updateTeamMembers(teamId) {
            // This would typically load from a database
            // For now, we'll use sample data
            if (teamId && teamData[teamId]) {
                teamData[teamId].members = [
                    { id: 1, name: 'ê¹€ì² ìˆ˜', position: 'ì„ ì„ê°œë°œì' },
                    { id: 2, name: 'ì´ì˜í¬', position: 'ê°œë°œì' },
                    { id: 3, name: 'ë°•ë¯¼ìˆ˜', position: 'ì£¼ë‹ˆì–´ê°œë°œì' }
                ];
            }
        }

        // Evaluation Management
        function loadEvaluationForm() {
            const targetSelect = document.getElementById('evaluationTarget');
            const formContainer = document.getElementById('evaluationForm');
            
            // Clear existing options
            targetSelect.innerHTML = '<option value="">í‰ê°€ ëŒ€ìƒìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            
            // Add team members to select
            Object.values(teamData).forEach(team => {
                if (team.members) {
                    team.members.forEach(member => {
                        const option = document.createElement('option');
                        option.value = member.id;
                        option.textContent = `${member.name} (${team.name})`;
                        targetSelect.appendChild(option);
                    });
                }
            });
            
            // Generate evaluation form
            generateEvaluationForm();
        }

        function generateEvaluationForm() {
            const formContainer = document.getElementById('evaluationForm');
            formContainer.innerHTML = '';

            evaluationItems.forEach((item, index) => {
                const formGroup = document.createElement('div');
                formGroup.className = 'bg-gray-50 p-4 rounded-lg';
                formGroup.innerHTML = `
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ${item.name} (ê°€ì¤‘ì¹˜: ${item.weight}%)
                    </label>
                    <div class="flex items-center space-x-4">
                        <input type="range" 
                               id="score_${item.id}" 
                               min="0" 
                               max="100" 
                               value="50" 
                               class="flex-1"
                               oninput="updateScoreDisplay(${item.id}, this.value)">
                        <span id="scoreDisplay_${item.id}" class="w-12 text-center font-medium">50</span>
                        <span class="text-gray-500">ì </span>
                    </div>
                    <textarea id="comment_${item.id}" 
                              placeholder="í‰ê°€ ì˜ê²¬ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                              class="mt-3 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                              rows="2"></textarea>
                `;
                formContainer.appendChild(formGroup);
            });
        }

        function updateScoreDisplay(itemId, score) {
            const display = document.getElementById(`scoreDisplay_${itemId}`);
            if (display) {
                display.textContent = score;
            }
        }

        function submitEvaluation() {
            const targetSelect = document.getElementById('evaluationTarget');
            const targetId = targetSelect.value;
            
            if (!targetId) {
                alert('í‰ê°€ ëŒ€ìƒìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const evaluation = {
                id: Date.now(),
                targetId: parseInt(targetId),
                evaluatorId: 1, // Current user
                date: new Date().toISOString(),
                scores: {},
                comments: {}
            };

            evaluationItems.forEach(item => {
                const scoreInput = document.getElementById(`score_${item.id}`);
                const commentInput = document.getElementById(`comment_${item.id}`);
                
                evaluation.scores[item.id] = parseInt(scoreInput.value);
                evaluation.comments[item.id] = commentInput.value;
            });

            evaluationData.push(evaluation);
            localStorage.setItem('evaluationData', JSON.stringify(evaluationData));
            
            alert('í‰ê°€ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.');
            loadEvaluationForm(); // Reset form
            updateOverviewStats();
        }

        // Data Management
        function loadData() {
            // Load evaluation items
            const savedItems = localStorage.getItem('evaluationItems');
            if (savedItems) {
                evaluationItems = JSON.parse(savedItems);
            } else {
                // Default evaluation items
                evaluationItems = [
                    { id: 1, name: 'ì—…ë¬´ ìˆ˜í–‰ ëŠ¥ë ¥', weight: 25, description: 'ë‹´ë‹¹ ì—…ë¬´ì˜ ì™„ìˆ˜ ì •ë„ì™€ í’ˆì§ˆ' },
                    { id: 2, name: 'í˜‘ì—… ë° ì†Œí†µ', weight: 20, description: 'íŒ€ì›Œí¬ì™€ ì˜ì‚¬ì†Œí†µ ëŠ¥ë ¥' },
                    { id: 3, name: 'ë¬¸ì œ í•´ê²° ëŠ¥ë ¥', weight: 25, description: 'ë¬¸ì œ ì¸ì‹ê³¼ í•´ê²° ë°©ì•ˆ ë„ì¶œ' },
                    { id: 4, name: 'ìê¸° ê³„ë°œ', weight: 15, description: 'ì§€ì†ì ì¸ í•™ìŠµê³¼ ì„±ì¥ ì˜ì§€' },
                    { id: 5, name: 'ë¦¬ë”ì‹­', weight: 15, description: 'íŒ€ì„ ì´ë„ëŠ” ëŠ¥ë ¥ê³¼ ì±…ì„ê°' }
                ];
            }

            // Load team data
            const savedTeamData = localStorage.getItem('teamData');
            if (savedTeamData) {
                teamData = JSON.parse(savedTeamData);
            }

            // Load evaluation data
            const savedEvaluationData = localStorage.getItem('evaluationData');
            if (savedEvaluationData) {
                evaluationData = JSON.parse(savedEvaluationData);
            }
        }

        function updateOverviewStats() {
            // Calculate statistics
            let totalMembers = 0;
            Object.values(teamData).forEach(team => {
                if (team.members) {
                    totalMembers += team.members.length;
                }
            });

            const completedEvaluations = evaluationData.length;
            const pendingEvaluations = totalMembers - completedEvaluations;

            // Update DOM
            document.getElementById('totalMembers').textContent = totalMembers;
            document.getElementById('completedEvaluations').textContent = completedEvaluations;
            document.getElementById('pendingEvaluations').textContent = Math.max(0, pendingEvaluations);
        }

        // Reports and Analysis
        function generateReports() {
            generateTeamScoreChart();
            generateProgressChart();
            generateReportTable();
        }

        function generateTeamScoreChart() {
            const ctx = document.getElementById('teamScoreChart');
            if (!ctx) return;

            // Sample data for demonstration
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ê°œë°œíŒ€', 'ë””ìì¸íŒ€', 'ê¸°íšíŒ€', 'ì¸í”„ë¼íŒ€'],
                    datasets: [{
                        label: 'í‰ê·  ì ìˆ˜',
                        data: [85, 78, 82, 88],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function generateProgressChart() {
            const ctx = document.getElementById('progressChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ì™„ë£Œ', 'ì§„í–‰ì¤‘', 'ëŒ€ê¸°'],
                    datasets: [{
                        data: [65, 25, 10],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true
                }
            });
        }

        function generateReportTable() {
            const tbody = document.getElementById('reportTable');
            if (!tbody) return;

            // Clear existing rows
            tbody.innerHTML = '';

            // Sample data
            const sampleData = [
                { name: 'ê¹€ì² ìˆ˜', team: 'ê°œë°œíŒ€', score: 85, grade: 'A', date: '2024-01-15' },
                { name: 'ì´ì˜í¬', team: 'ê°œë°œíŒ€', score: 78, grade: 'B', date: '2024-01-14' },
                { name: 'ë°•ë¯¼ìˆ˜', team: 'ë””ìì¸íŒ€', score: 92, grade: 'A+', date: '2024-01-13' }
            ];

            sampleData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.team}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.score}ì </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.grade}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.date}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function generateAnalysis() {
            generateItemAnalysisChart();
            generateDistributionChart();
        }

        function generateItemAnalysisChart() {
            const ctx = document.getElementById('itemAnalysisChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: evaluationItems.map(item => item.name),
                    datasets: [{
                        label: 'í‰ê·  ì ìˆ˜',
                        data: evaluationItems.map(() => Math.floor(Math.random() * 40) + 60),
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        pointBackgroundColor: 'rgba(59, 130, 246, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function generateDistributionChart() {
            const ctx = document.getElementById('distributionChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['0-20', '21-40', '41-60', '61-80', '81-100'],
                    datasets: [{
                        label: 'ì¸ì› ìˆ˜',
                        data: [1, 3, 8, 15, 12],
                        backgroundColor: 'rgba(59, 130, 246, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // User Role Management
        function switchUserRole() {
            const roleSelect = document.getElementById('userRoleSelect');
            currentUserRole = roleSelect.value;
            
            // Update current user display
            const currentUserSpan = document.getElementById('currentUser');
            if (currentUserRole === 'admin') {
                currentUserSpan.textContent = 'ê´€ë¦¬ì';
                showAdminTabs();
            } else {
                // ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤
                currentEmployee = {
                    id: 1,
                    name: 'ê¹€ì² ìˆ˜',
                    team: 'ê°œë°œíŒ€',
                    position: 'ì„ ì„ê°œë°œì'
                };
                currentUserSpan.textContent = currentEmployee.name;
                showEmployeeTabs();
            }
            
            // Switch to appropriate tab
            if (currentUserRole === 'admin') {
                showTab('overview');
            } else {
                showTab('self-evaluation');
            }
        }

        function showAdminTabs() {
            // Show admin tabs
            const tabs = ['overview', 'settings', 'evaluation', 'reports', 'analysis'];
            tabs.forEach(tab => {
                const button = document.querySelector(`[onclick="showTab('${tab}')"]`);
                if (button) button.style.display = 'block';
            });
            
            // Hide employee tabs
            document.getElementById('selfEvaluationTab').style.display = 'none';
        }

        function showEmployeeTabs() {
            // Hide admin tabs
            const tabs = ['settings', 'evaluation', 'reports', 'analysis'];
            tabs.forEach(tab => {
                const button = document.querySelector(`[onclick="showTab('${tab}')"]`);
                if (button) button.style.display = 'none';
            });
            
            // Show employee tabs
            document.getElementById('selfEvaluationTab').style.display = 'block';
            
            // Keep overview visible for basic stats
            const overviewTab = document.querySelector(`[onclick="showTab('overview')"]`);
            if (overviewTab) overviewTab.style.display = 'block';
        }

        // User Menu Functions
        function showUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        }

        function showUserProfile() {
            alert('í”„ë¡œí•„ í˜ì´ì§€ëŠ” í–¥í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
            document.getElementById('userMenu').classList.add('hidden');
        }

        function showUserSettings() {
            alert('ì‚¬ìš©ì ì„¤ì • í˜ì´ì§€ëŠ” í–¥í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
            document.getElementById('userMenu').classList.add('hidden');
        }

        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ì‹¤ì œë¡œëŠ” ì„œë²„ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
                currentUserRole = 'admin';
                document.getElementById('userRoleSelect').value = 'admin';
                switchUserRole();
            }
            document.getElementById('userMenu').classList.add('hidden');
        }

        // Close user menu when clicking outside
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('userMenu');
            const button = e.target.closest('[onclick="showUserMenu()"]');
            if (!button && !menu.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });

        // Self Evaluation Functions
        function loadSelfEvaluationPeriod() {
            const period = document.getElementById('evaluationPeriod').value;
            
            if (!period) {
                document.getElementById('selfEvaluationForm').style.display = 'none';
                return;
            }
            
            // Set deadline based on period
            const deadlines = {
                '2025-q1': '2025-04-15',
                '2025-q2': '2025-07-15', 
                '2025-annual': '2025-01-31'
            };
            
            document.getElementById('evaluationDeadline').value = deadlines[period] || '';
            
            // Check deadline proximity
            checkDeadlineProximity(deadlines[period]);
            
            // Load evaluation form
            document.getElementById('selfEvaluationForm').style.display = 'block';
            generateSelfEvaluationForm();
            loadSelfEvaluationDraft(period);
        }

        function checkDeadlineProximity(deadline) {
            if (!deadline) return;
            
            const deadlineDate = new Date(deadline);
            const now = new Date();
            const daysUntilDeadline = Math.ceil((deadlineDate - now) / (1000 * 60 * 60 * 24));
            
            const alert = document.getElementById('deadlineAlert');
            const text = document.getElementById('deadlineText');
            
            if (daysUntilDeadline <= 7) {
                alert.classList.remove('hidden');
                if (daysUntilDeadline <= 0) {
                    text.textContent = 'í‰ê°€ ë§ˆê°ì¼ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤!';
                } else if (daysUntilDeadline === 1) {
                    text.textContent = 'í‰ê°€ ë§ˆê°ê¹Œì§€ 1ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤!';
                } else {
                    text.textContent = `í‰ê°€ ë§ˆê°ê¹Œì§€ ${daysUntilDeadline}ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`;
                }
            } else {
                alert.classList.add('hidden');
            }
        }

        function generateSelfEvaluationForm() {
            const container = document.getElementById('selfEvaluationItems');
            container.innerHTML = '';

            evaluationItems.forEach((item, index) => {
                const itemElement = createSelfEvaluationItem(item, index);
                container.appendChild(itemElement);
            });

            updateSelfEvaluationStats();
        }

        function createSelfEvaluationItem(item, index) {
            const div = document.createElement('div');
            div.className = 'bg-gray-50 p-6 rounded-lg border border-gray-200';

            div.innerHTML = `
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <h5 class="text-lg font-medium text-gray-900">${item.name}</h5>
                        <p class="text-sm text-gray-600">ê°€ì¤‘ì¹˜: ${item.weight}%</p>
                        ${item.description ? `<p class="text-sm text-gray-500 mt-1">${item.description}</p>` : ''}
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-blue-600" id="selfScore_${item.id}">0</div>
                        <div class="text-xs text-gray-500">ì </div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <!-- Score Input -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ìê¸°í‰ê°€ ì ìˆ˜ (1-100)</label>
                        <div class="flex items-center space-x-4">
                            <input type="range" 
                                   id="selfRange_${item.id}" 
                                   min="1" 
                                   max="100" 
                                   value="50" 
                                   class="flex-1"
                                   oninput="updateSelfScore(${item.id}, this.value)">
                            <input type="number" 
                                   id="selfNumber_${item.id}" 
                                   min="1" 
                                   max="100" 
                                   value="50" 
                                   class="w-20 px-3 py-2 border border-gray-300 rounded-md text-center"
                                   onchange="updateSelfScore(${item.id}, this.value)">
                        </div>
                    </div>
                    
                    <!-- Self Assessment Text -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ìê¸°í‰ê°€ ë‚´ìš©</label>
                        <textarea id="selfText_${item.id}" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                  rows="3" 
                                  placeholder="ì´ í•­ëª©ì— ëŒ€í•œ ë³¸ì¸ì˜ ì„±ê³¼ì™€ ê·¼ê±°ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
                    </div>
                    
                    <!-- Evidence/Examples -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">êµ¬ì²´ì  ì‚¬ë¡€ ë° ì¦ê±°</label>
                        <textarea id="selfEvidence_${item.id}" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                  rows="2" 
                                  placeholder="ì ìˆ˜ë¥¼ ë’·ë°›ì¹¨í•˜ëŠ” êµ¬ì²´ì ì¸ ì‚¬ë¡€ë‚˜ ì„±ê³¼ë¬¼ì„ ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
                    </div>
                </div>
            `;

            return div;
        }

        function updateSelfScore(itemId, score) {
            score = Math.max(1, Math.min(100, parseInt(score) || 1));
            
            // Update displays
            document.getElementById(`selfScore_${itemId}`).textContent = score;
            document.getElementById(`selfRange_${itemId}`).value = score;
            document.getElementById(`selfNumber_${itemId}`).value = score;
            
            // Auto-save
            autoSaveSelfEvaluation();
        }

        function updateSelfEvaluationStats() {
            // ì‹¤ì œë¡œëŠ” í˜„ì¬ ì‚¬ìš©ìì˜ í‰ê°€ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°
            const totalItems = evaluationItems.length;
            const completedItems = 0; // ì‹¤ì œ ì™„ë£Œëœ í•­ëª© ìˆ˜
            const progress = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;
            
            document.getElementById('selfCompletedCount').textContent = completedItems;
            document.getElementById('selfPendingCount').textContent = totalItems - completedItems;
            document.getElementById('selfProgressPercent').textContent = `${progress}%`;
        }

        function saveSelfEvaluationDraft() {
            const period = document.getElementById('evaluationPeriod').value;
            if (!period) {
                alert('í‰ê°€ ê¸°ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const draft = collectSelfEvaluationData();
            selfEvaluationDrafts[period] = draft;
            localStorage.setItem('selfEvaluationDrafts', JSON.stringify(selfEvaluationDrafts));
            
            // Update last saved time
            const now = new Date().toLocaleString('ko-KR');
            document.getElementById('lastSavedTime').textContent = `ë§ˆì§€ë§‰ ì €ì¥: ${now}`;
            
            // Show success message
            showToast('í‰ê°€ê°€ ì„ì‹œì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function loadSelfEvaluationDraft(period) {
            const savedDrafts = localStorage.getItem('selfEvaluationDrafts');
            if (savedDrafts) {
                selfEvaluationDrafts = JSON.parse(savedDrafts);
                const draft = selfEvaluationDrafts[period];
                
                if (draft) {
                    // Load scores and texts
                    if (draft.items) {
                        Object.keys(draft.items).forEach(itemId => {
                            const itemData = draft.items[itemId];
                            if (itemData.score) {
                                updateSelfScore(itemId, itemData.score);
                            }
                            if (itemData.text) {
                                const textArea = document.getElementById(`selfText_${itemId}`);
                                if (textArea) textArea.value = itemData.text;
                            }
                            if (itemData.evidence) {
                                const evidenceArea = document.getElementById(`selfEvidence_${itemId}`);
                                if (evidenceArea) evidenceArea.value = itemData.evidence;
                            }
                        });
                    }
                    
                    // Load overall assessment
                    if (draft.overall) {
                        const achievements = document.getElementById('selfMajorAchievements');
                        const improvements = document.getElementById('selfImprovementAreas');
                        const goals = document.getElementById('selfFutureGoals');
                        
                        if (achievements) achievements.value = draft.overall.achievements || '';
                        if (improvements) improvements.value = draft.overall.improvements || '';
                        if (goals) goals.value = draft.overall.goals || '';
                    }
                    
                    // Update last saved time
                    if (draft.savedAt) {
                        document.getElementById('lastSavedTime').textContent = `ë§ˆì§€ë§‰ ì €ì¥: ${draft.savedAt}`;
                    }
                }
            }
        }

        function collectSelfEvaluationData() {
            const data = {
                items: {},
                overall: {
                    achievements: document.getElementById('selfMajorAchievements')?.value || '',
                    improvements: document.getElementById('selfImprovementAreas')?.value || '',
                    goals: document.getElementById('selfFutureGoals')?.value || ''
                },
                savedAt: new Date().toLocaleString('ko-KR')
            };
            
            evaluationItems.forEach(item => {
                const scoreElement = document.getElementById(`selfNumber_${item.id}`);
                const textElement = document.getElementById(`selfText_${item.id}`);
                const evidenceElement = document.getElementById(`selfEvidence_${item.id}`);
                
                data.items[item.id] = {
                    score: scoreElement?.value || 50,
                    text: textElement?.value || '',
                    evidence: evidenceElement?.value || ''
                };
            });
            
            return data;
        }

        function autoSaveSelfEvaluation() {
            // Auto-save every 30 seconds when user is typing
            clearTimeout(window.autoSaveTimeout);
            window.autoSaveTimeout = setTimeout(() => {
                saveSelfEvaluationDraft();
            }, 30000);
        }

        function previewSelfEvaluation() {
            const data = collectSelfEvaluationData();
            // ì‹¤ì œë¡œëŠ” ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ì´ë‚˜ ìƒˆ íƒ­ì—ì„œ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
            alert('ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ì€ í–¥í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        function submitSelfEvaluation() {
            const period = document.getElementById('evaluationPeriod').value;
            if (!period) {
                alert('í‰ê°€ ê¸°ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ëª¨ë“  í•­ëª©ì´ ì‘ì„±ë˜ì—ˆëŠ”ì§€ ê²€ì¦
            let isComplete = true;
            let missingItems = [];
            
            evaluationItems.forEach(item => {
                const textElement = document.getElementById(`selfText_${item.id}`);
                if (!textElement?.value.trim()) {
                    isComplete = false;
                    missingItems.push(item.name);
                }
            });
            
            if (!isComplete) {
                alert(`ë‹¤ìŒ í•­ëª©ì˜ ìê¸°í‰ê°€ ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”:\n${missingItems.join('\n')}`);
                return;
            }
            
            // ìµœì¢… í™•ì¸
            if (!confirm('ìê¸°í‰ê°€ë¥¼ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì œì¶œ í›„ì—ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            // ë°ì´í„° ìˆ˜ì§‘ ë° ì €ì¥
            const evaluationData = {
                ...collectSelfEvaluationData(),
                period: period,
                employeeId: currentEmployee?.id,
                employeeName: currentEmployee?.name,
                submittedAt: new Date().toISOString(),
                status: 'submitted'
            };
            
            // ì‹¤ì œë¡œëŠ” ì„œë²„ì— ì œì¶œ
            selfEvaluationData[period] = evaluationData;
            localStorage.setItem('selfEvaluationData', JSON.stringify(selfEvaluationData));
            
            // ì„ì‹œì €ì¥ ë°ì´í„° ì‚­ì œ
            delete selfEvaluationDrafts[period];
            localStorage.setItem('selfEvaluationDrafts', JSON.stringify(selfEvaluationDrafts));
            
            showToast('ìê¸°í‰ê°€ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('evaluationPeriod').value = '';
            document.getElementById('selfEvaluationForm').style.display = 'none';
            
            // ì´ì „ í‰ê°€ ëª©ë¡ ì—…ë°ì´íŠ¸
            loadPreviousSelfEvaluations();
        }

        function resetSelfEvaluation() {
            if (!confirm('ì‘ì„± ì¤‘ì¸ ìê¸°í‰ê°€ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì €ì¥ë˜ì§€ ì•Šì€ ë‚´ìš©ì€ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')) {
                return;
            }
            
            // Reset all scores to 50
            evaluationItems.forEach(item => {
                updateSelfScore(item.id, 50);
                const textElement = document.getElementById(`selfText_${item.id}`);
                const evidenceElement = document.getElementById(`selfEvidence_${item.id}`);
                if (textElement) textElement.value = '';
                if (evidenceElement) evidenceElement.value = '';
            });
            
            // Reset overall assessment
            document.getElementById('selfMajorAchievements').value = '';
            document.getElementById('selfImprovementAreas').value = '';
            document.getElementById('selfFutureGoals').value = '';
            
            // Reset last saved time
            document.getElementById('lastSavedTime').textContent = 'ì•„ì§ ì €ì¥ë˜ì§€ ì•ŠìŒ';
            
            showToast('ìê¸°í‰ê°€ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        function loadPreviousSelfEvaluations() {
            const container = document.getElementById('previousSelfEvaluations');
            const savedEvaluations = localStorage.getItem('selfEvaluationData');
            
            if (!savedEvaluations) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-history text-4xl mb-4 opacity-50"></i>
                        <p>ì•„ì§ ì™„ë£Œëœ ìê¸°í‰ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p class="text-sm">ì²« ë²ˆì§¸ ìê¸°í‰ê°€ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
                return;
            }
            
            const evaluations = JSON.parse(savedEvaluations);
            container.innerHTML = '';
            
            Object.keys(evaluations).forEach(period => {
                const evaluation = evaluations[period];
                const item = document.createElement('div');
                item.className = 'bg-gray-50 p-4 rounded-lg border border-gray-200';
                
                // Calculate average score
                const scores = Object.values(evaluation.items).map(item => parseInt(item.score));
                const averageScore = scores.reduce((a, b) => a + b, 0) / scores.length;
                
                item.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-medium text-gray-900">${getPeriodName(period)}</h4>
                            <p class="text-sm text-gray-600">ì œì¶œì¼: ${new Date(evaluation.submittedAt).toLocaleDateString('ko-KR')}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-semibold text-blue-600">${Math.round(averageScore)}ì </div>
                            <button onclick="viewSelfEvaluation('${period}')" class="text-sm text-blue-600 hover:underline">
                                ìì„¸íˆ ë³´ê¸°
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        function getPeriodName(period) {
            const names = {
                '2025-q1': '2025ë…„ 1ë¶„ê¸° í‰ê°€',
                '2025-q2': '2025ë…„ 2ë¶„ê¸° í‰ê°€',
                '2025-annual': '2025ë…„ ì—°ê°„ í‰ê°€'
            };
            return names[period] || period;
        }

        function viewSelfEvaluation(period) {
            // ì‹¤ì œë¡œëŠ” ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ì´ë‚˜ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤
            alert(`${getPeriodName(period)} ìƒì„¸ë³´ê¸°ëŠ” í–¥í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.`);
        }

        function loadSelfEvaluationTab() {
            // Load previous evaluations
            loadPreviousSelfEvaluations();
            
            // Update stats
            updateSelfEvaluationStats();
            
            // Load saved data
            const savedEvaluations = localStorage.getItem('selfEvaluationData');
            const savedDrafts = localStorage.getItem('selfEvaluationDrafts');
            
            if (savedEvaluations) {
                selfEvaluationData = JSON.parse(savedEvaluations);
            }
            
            if (savedDrafts) {
                selfEvaluationDrafts = JSON.parse(savedDrafts);
            }
        }

        function showToast(message, type = 'info') {
            // Simple toast notification
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-md text-white z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Error handling for browser extensions and compatibility
        window.addEventListener('error', function(e) {
            if (e.message && e.message.includes('Extension context invalidated')) {
                console.log('Browser extension conflict detected, continuing normally...');
                return true;
            }
        });

        window.addEventListener('unhandledrejection', function(e) {
            if (e.reason && typeof e.reason === 'string' && e.reason.includes('Extension context')) {
                console.log('Browser extension promise rejection, continuing normally...');
                e.preventDefault();
                return true;
            }
        });
    </script>
</body>
</html>